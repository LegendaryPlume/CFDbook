(window.webpackJsonp=window.webpackJsonp||[]).push([[193],{522:function(e,t,s){"use strict";s.r(t);var r=s(12),a=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"_1-命令简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-命令简介"}},[e._v("#")]),e._v(" 1.命令简介")]),e._v(" "),t("p",[e._v("scp（secure copy）是 "),t("a",{attrs:{href:"https://www.openssh.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenSSH"),t("OutboundLink")],1),e._v(" 套件中的安全远程文件拷贝工具。")]),e._v(" "),t("p",[e._v("scp 基于 SSH 协议可安全地进行远程文件拷贝，数据传输过程会进行加密。和它类似的命令有 cp，不过 cp 只能在本机进行拷贝不能跨服务器，而且 scp 支持对传输的数据进行加密。")]),e._v(" "),t("h2",{attrs:{id:"_2-命令格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-命令格式"}},[e._v("#")]),e._v(" 2.命令格式")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp [-1246BCpqrv] [-c cipher] [-F ssh_config] [-i identity_file] [-l limit] [-o ssh_option] [-P port] [-S program] \n\t[[user@]host1:]file1 ... [[user@]host2:]file2\n")])])]),t("h2",{attrs:{id:"_3-选项说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-选项说明"}},[e._v("#")]),e._v(" 3.选项说明")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("-1\n\t使用 SSH 协议版本 1\n-2\n\t使用 SSH 协议版本 2\n-4\n\t使用 ipv4\n-6\n\t使用 ipv6\n-B\n\t以批处理模式运行，阻止 scp 询问口令\n-C\n\t使用压缩，将 -C 标志传递给 SSH，从而打开压缩功能\n-c CIPHER\n\t使用指定的秘钥对传输的文件进行加密\n-F SSH_CONFIG\n\t指定 SSH 配置文件\n-i IDENTITY_FILE\n\t从指定文件中读取传输时使用的密钥，此参数直接传递给 ssh\n-l LIMIT\n\t指定宽带限制\n-o SSH_OPTION\n\t指定使用的 ssh 选项，可以使用 SSH_CONFIG 中使用的 ssh 选项\n-P PORT\n\t指定远程主机的端口号\n-p\n\t保留文件的最后修改时间，最后访问时间和权限模式\n-q\n\t静默模式，不显示复制进度以及来自 ssh 的警告和诊断消息\n-r\n\t以递归方式复制整个目录\n-S PROGRAM\n\t指定加密传输时所使用的程序。此程序必须能够理解 ssh 的选项\n-v\n\t使用冗余模式，使 scp 和 ssh 打印调试信息以及进度\n")])])]),t("p",[t("strong",[e._v("注意事项：")]),e._v("\n（1）scp 返回 0 成功，>0 失败；\n（2）使用 scp 在不同主机之间进行文件传输，需要确保两台设备都开启了ssh远程登录服务，且两台设备能互相通信；\n（3）使用 scp 命令要确保使用的用户具有可读取远程服务器相应文件的权限，否则scp 命令无法起作用。")]),e._v(" "),t("h2",{attrs:{id:"_4-常用示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-常用示例"}},[e._v("#")]),e._v(" 4.常用示例")]),e._v(" "),t("p",[e._v("（1）远程主机之间，使用 scp 拷贝多个文件。")]),e._v(" "),t("p",[e._v("方法一：将多个文件放在同一个目录中，使用"),t("code",[e._v("scp -r")]),e._v("来拷贝。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp -r UerName@SrcHostName:SrcDir UserName@DstHostName:DstDir\n")])])]),t("p",[e._v("方法二：将多个文件或者目录使用 tar 打包后作为单个文件传输。")]),e._v(" "),t("p",[e._v("方法三：scp 支持同时拷贝多个文件的功能。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp file1  file2 remote_username@remote_ip:remote_folder \n")])])]),t("p",[e._v("（2）从本地复制文件到远程。")]),e._v(" "),t("p",[e._v("命令格式：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp local_file  remote_username@remote_ip:remote_folder \n# 或\nscp local_file remote_username@remote_ip:remote_file \n# 或\nscp local_file remote_ip:remote_folder \n# 或\nscp local_file remote_ip:remote_file \n")])])]),t("p",[e._v("第1,2个指定了用户名，命令执行后需要再输入密码，第1个仅指定了远程的目录，文件名字不变，第2个指定了文件名；\n第3,4个没有指定用户名，命令执行后需要输入用户名和密码，第3个仅指定了远程的目录，文件名字不变，第4个指定了文件名。\n应用实例：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music \nscp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music/001.mp3 \nscp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music \nscp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music/001.mp3 \n")])])]),t("p",[e._v("（3）使用 scp 复制目录。")]),e._v(" "),t("p",[e._v("命令格式：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp -r local_folder remote_username@remote_ip:remote_folder \n# 或\nscp -r local_folder remote_ip:remote_folder\n")])])]),t("p",[e._v("第 1 个指定了用户名，命令执行后需要再输入密码；\n第 2 个没有指定用户名，命令执行后需要输入用户名和密码。\n应用实例：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp -r /home/space/music/ root@www.runoob.com:/home/root/others/ \nscp -r /home/space/music/ www.runoob.com:/home/root/others/ \n")])])]),t("p",[e._v("上面命令将本地 music 目录复制到远程 others 目录下。")]),e._v(" "),t("p",[e._v("（4）从远程复制到本地。")]),e._v(" "),t("p",[e._v("从远程复制到本地，只要将从本地复制到远程的命令的后2个参数调换顺序即可，如下实例\n应用实例：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp root@www.runoob.com:/home/root/others/music /home/space/music/1.mp3 \nscp -r www.runoob.com:/home/root/others/ /home/space/music/\n")])])]),t("p",[t("strong",[e._v("说明")]),e._v("：如果远程服务器防火墙有为scp命令设置了指定的端口，我们需要使用 -P 参数来设置命令的端口号，命令格式如下：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("#scp 命令使用端口号 4588\nscp -P 4588 remote@www.runoob.com:/usr/local/sin.sh /home/administrator\n")])])]),t("p",[e._v("（5）使用 expect 和 scp 实现不同主机之间文件的自动传输。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('#!/usr/bin/expect\nset timeout 5\nspawn scp dablelv@172.25.44.22:/yourpath/yourfile root@10.130.89.104:/destinationpath\nexpect "dablelv@172.25.44.22\'s password:"\nsend "123456\\n"\nexpect "root@10.130.89.104\'s password:"\nsend "123456\\n"\ninteract eof\n')])])]),t("p",[e._v("脚本解释：")]),e._v(" "),t("p",[e._v("第一行："),t("code",[e._v("#!/usr/bin/expect")]),e._v(" 指明该脚本由expect来解析。这里的expect其实和linux下的bash、Windows下的cmd.exe是一类东西，都是可执行程序，也可用于脚本的解析器。expect的主要作用是解析自动交互的脚本，比如实现ssh的自动登录，无需手动输入密码等。")]),e._v(" "),t("p",[e._v("第二行："),t("code",[e._v("set timeout 5")]),e._v(" 用于设置expect的expect命令的等待时间为5秒，如果expect等待的值在5秒内没有出现在标准输出，那么expect脚本继续执行。expect的默认timeout为10s。")]),e._v(" "),t("p",[e._v("第三行："),t("code",[e._v("spawn scp dablelv@172.25.44.22:/yourpath/yourfile")]),e._v("。spawn是expect的内置命令，不是Linux可执行程序，使用"),t("code",[e._v("which spawn")]),e._v(" 是查不到spawn所在路径的。这个就好比cd是shell的内建命令，离开shell，就无法执行cd一样。 它主要的功能是给ssh运行进程加个壳，用来传递交互指令。 它主要的功能是给后面需要执行的命令加个壳，用来传递交互指令。")]),e._v(" "),t("p",[e._v("第四行："),t("code",[e._v('expect "dablelv@172.25.44.22\'s password:"')]),e._v(" expect命令也是expect的内建命令，其作用就是等待标准输出出现指定的值，如果有则立即返回，向下执行；否则就一直等待，等待的最长时间由上面的"),t("code",[e._v("set timeout")]),e._v("来指定。")]),e._v(" "),t("p",[e._v("第五行："),t("code",[e._v('send "123456\\n"')]),e._v("就是在expect等待到指定的值之后向标准输出发送的值，这里就是执行交互动作，与手工输入密码的动作等效。效果上跟用户手动在终端上输入123456之后敲一个回车一样。")]),e._v(" "),t("p",[e._v("第六、七行实现的功能同第五六行，因为scp需要登录到两个主机实现文件的网络传输，所以这里是登录第二台主机需要输入的密码。")]),e._v(" "),t("p",[e._v("第八行："),t("code",[e._v("interact eof")]),e._v(" 表示expect脚本执行结束。执行完成上述命令后，此时Expect会把控制权交给控制台，这个时候就变回手工操作。如果是使用ssh登录其它主机的话，需要保持在交互状态，那么此时需要"),t("code",[e._v("interact")]),e._v("，如果没有这一句登录完成后会立刻退出，而不是留在远程终端上。如果你只是登录过去执行一段命令就退出，可将其改为"),t("code",[e._v("expect eof")]),e._v("。")]),e._v(" "),t("p",[e._v('如果出现 ": no such file or directory 这样的错误，很可能是因为在本地Windows环境编辑，上传到Linux下执行因文件格式不同导致的，可使用vi或者vim在末行模式使用'),t("code",[e._v(":set ff")]),e._v("来查看文件格式，如果是dos格式的话，那么需要使用"),t("code",[e._v(":set ff=unix")]),e._v(" 来改变文件格式。")]),e._v(" "),t("hr"),e._v(" "),t("h2",{attrs:{id:"参考文献"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[e._v("#")]),e._v(" 参考文献")]),e._v(" "),t("p",[t("a",{attrs:{href:"http://man7.org/linux/man-pages/man1/scp.1.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("scp(1) - Linux manual page - man7.org"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"http://man.linuxde.net/scp",target:"_blank",rel:"noopener noreferrer"}},[e._v("scp命令 - Linux命令大全"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"http://www.runoob.com/linux/linux-comm-scp.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Linux scp命令"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"http://www.cnblogs.com/gylei/archive/2013/05/11/3072331.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("expect简单教程 "),t("OutboundLink")],1)]),e._v(" "),t("Vssue",{attrs:{title:"scp"}})],1)}),[],!1,null,null,null);t.default=a.exports}}]);