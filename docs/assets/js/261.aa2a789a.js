(window.webpackJsonp=window.webpackJsonp||[]).push([[261],{595:function(t,a,e){"use strict";e.r(a);var r=e(12),_=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-命令简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-命令简介"}},[t._v("#")]),t._v(" 1.命令简介")]),t._v(" "),a("p",[t._v("trap 命令是 Shell 内建命令，用于指定在接收到信号后将要采取的动作。常见的用途是在脚本程序被中断时完成清理工作。")]),t._v(" "),a("h2",{attrs:{id:"_2-命令格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-命令格式"}},[t._v("#")]),t._v(" 2.命令格式")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("trap [-lp] [ARG] [SIGSPECS]\n")])])]),a("h2",{attrs:{id:"_3-选项说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-选项说明"}},[t._v("#")]),t._v(" 3.选项说明")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-l\n\t列出信号名称与对应的数值\n-p\n\t列出信号与其绑定的命令列表\nARG\n\t与指定信号绑定的命令。如果 ARG 为空字符串，表示忽略信号；如果 ARG 不指定（缺省）或为 -，表示执行信号的默认动作\nSIGSPECS\n\t信号列表，可以是信号名称，也可以是信号对应的数值。可用信号可以使用 trap -l 查看\n")])])]),a("h2",{attrs:{id:"_4-常用示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-常用示例"}},[t._v("#")]),t._v(" 4.常用示例")]),t._v(" "),a("p",[t._v("（1）忽略 HUP、INT、QUIT、TSTP 信号。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('trap "" HUP INT QUIT TSTP\n')])])]),a("p",[t._v("（2）捕获 HUP、INT、QUIT、TSTP 信号，并执行默认动作。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("trap HUP INT QUIT TSTP\n#或\ntrap - HUP INT QUIT TSTP\n")])])]),a("p",[t._v('（3）挂载 Shell 进程结束前需要执行的命令。格式为：trap "commands" EXIT。如脚本 exit.sh：')]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('#!/bin/bash\n\necho "start"\ntrap "echo \'end\'" EXIT\necho "before exit"\nexit 0\n')])])]),a("p",[t._v("执行 exit.sh 输出：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("start\nbefore exit\nend\n")])])]),a("h2",{attrs:{id:"_5-信号简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-信号简介"}},[t._v("#")]),t._v(" 5.信号简介")]),t._v(" "),a("p",[t._v("信号是一种进程间通信机制，它给应用程序提供一种异步的软件中断，使应用程序有机会接受其他程序发送的命令（即信号）。应用程序收到信号后，有三种处理方式：忽略、默认或捕捉。进程收到一个信号后，会检查对该信号的处理机制。如果是 SIG_IGN，就忽略该信号；如果是 SIG_DFT，则会采用系统默认的处理动作，通常是终止进程或忽略该信号；如果给该信号指定了一个处理函数，则会中断当前进程正在执行的任务，转而去执行该信号的处理函数，返回后再继续执行被中断的任务。")]),t._v(" "),a("p",[t._v("在有些情况下，我们不希望自己的 Shell 脚本在运行时被中断，比如说我们写的 Shell 脚本设为某一用户登录系统后默认执行的 Shell 脚本，使这一用户进入系统后只能做某一项工作，如数据库备份， 我们不希望用户使用 Ctrl+C 发送 SIGINT 信号来中断当前 Shell 脚本的执行，进入到 Shell 交互模式，做我们不希望做的事情。这便用到了信号处理。")]),t._v(" "),a("p",[t._v("以下是一些你可能会遇到的，要在程序中使用的常见的信号：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("信号名称")]),t._v(" "),a("th",[t._v("信号数值")]),t._v(" "),a("th",[t._v("默认动作")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("SIGHUP")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("终止进程")]),t._v(" "),a("td",[t._v("终端连接结束时发出。终端连接断开，会向当前终端连接会话关联的所有前台和后台进程组发送SIGHUP信号，用于终止进程。")])]),t._v(" "),a("tr",[a("td",[t._v("SIGINT")]),t._v(" "),a("td",[t._v("2")]),t._v(" "),a("td",[t._v("终止进程")]),t._v(" "),a("td",[t._v("程序终止（Interrupt）信号，通常是由Ctrl+C发出。")])]),t._v(" "),a("tr",[a("td",[t._v("SIGQUIT")]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",[t._v("终止进程")]),t._v(" "),a("td",[t._v("和SIGINT类似,通常是Ctrl+/发出。进程在收到SIGQUIT信号退出时会产生core文件, 在这个意义上类似于一个程序错误信号。")])]),t._v(" "),a("tr",[a("td",[t._v("SIGFPE")]),t._v(" "),a("td",[t._v("8")]),t._v(" "),a("td",[t._v("终止进程，建立CORE文件")]),t._v(" "),a("td",[t._v("在发生致命的算术运算错误（Floating-Point Exception）时发出，不仅包括浮点运算错误, 还包括溢出及除数为0等其它所有的算术错误。")])]),t._v(" "),a("tr",[a("td",[t._v("SIGKILL")]),t._v(" "),a("td",[t._v("9")]),t._v(" "),a("td",[t._v("终止进程")]),t._v(" "),a("td",[t._v("用来立即结束程序的运行。本信号不能被阻塞, 处理和忽略。")])]),t._v(" "),a("tr",[a("td",[t._v("SIGSEGV")]),t._v(" "),a("td",[t._v("11")]),t._v(" "),a("td",[t._v("终止进程，建立CORE文件")]),t._v(" "),a("td",[t._v("段错误（Segmentation Fault）信号。进程试图访问非法内存地址，如往没有写权限的内存地址写数据时会触发段错误。")])]),t._v(" "),a("tr",[a("td",[t._v("SIGALRM")]),t._v(" "),a("td",[t._v("14")]),t._v(" "),a("td",[t._v("终止进程")]),t._v(" "),a("td",[t._v("时钟定时信号, 计时器到时会发出该信号。alarm()函数使用该信号。")])]),t._v(" "),a("tr",[a("td",[t._v("SIGTERM")]),t._v(" "),a("td",[t._v("15")]),t._v(" "),a("td",[t._v("终止进程")]),t._v(" "),a("td",[t._v("程序结束(Terminate)信号, 与SIGKILL不同的是该信号可以被阻塞和处理。通常用来要求程序自己正常退出。Shell命令kill缺省产生这个信号。")])]),t._v(" "),a("tr",[a("td",[t._v("SIGCHLD")]),t._v(" "),a("td",[t._v("17")]),t._v(" "),a("td",[t._v("忽略信号")]),t._v(" "),a("td",[t._v("子进程结束时, 父进程会收到这个信号")])])])]),t._v(" "),a("p",[t._v("详细的信号列表，可以使用命令"),a("code",[t._v("trap -l")]),t._v("或"),a("code",[t._v("kill -l")]),t._v("查看，也可以查看头文件<signal.h>。例如，执行"),a("code",[t._v("trap -l")]),t._v("，查看系统支持的所有信号如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" 1) SIGHUP\t 2) SIGINT\t 3) SIGQUIT\t 4) SIGILL\t 5) SIGTRAP\n 6) SIGABRT\t 7) SIGBUS\t 8) SIGFPE\t 9) SIGKILL\t10) SIGUSR1\n11) SIGSEGV\t12) SIGUSR2\t13) SIGPIPE\t14) SIGALRM\t15) SIGTERM\n16) SIGSTKFLT\t17) SIGCHLD\t18) SIGCONT\t19) SIGSTOP\t20) SIGTSTP\n21) SIGTTIN\t22) SIGTTOU\t23) SIGURG\t24) SIGXCPU\t25) SIGXFSZ\n26) SIGVTALRM\t27) SIGPROF\t28) SIGWINCH\t29) SIGIO\t30) SIGPWR\n31) SIGSYS\t34) SIGRTMIN\t35) SIGRTMIN+1\t36) SIGRTMIN+2\t37) SIGRTMIN+3\n38) SIGRTMIN+4\t39) SIGRTMIN+5\t40) SIGRTMIN+6\t41) SIGRTMIN+7\t42) SIGRTMIN+8\n43) SIGRTMIN+9\t44) SIGRTMIN+10\t45) SIGRTMIN+11\t46) SIGRTMIN+12\t47) SIGRTMIN+13\n48) SIGRTMIN+14\t49) SIGRTMIN+15\t50) SIGRTMAX-14\t51) SIGRTMAX-13\t52) SIGRTMAX-12\n53) SIGRTMAX-11\t54) SIGRTMAX-10\t55) SIGRTMAX-9\t56) SIGRTMAX-8\t57) SIGRTMAX-7\n58) SIGRTMAX-6\t59) SIGRTMAX-5\t60) SIGRTMAX-4\t61) SIGRTMAX-3\t62) SIGRTMAX-2\n63) SIGRTMAX-1\t64) SIGRTMAX\n")])])]),a("h2",{attrs:{id:"参考文献"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[t._v("#")]),t._v(" 参考文献")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.man7.org/linux/man-pages/man1/bash.1.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("bash(1) - Linux manual page - man7.org"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://man7.org/linux/man-pages/man1/trap.1p.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("trap(1p) - Linux manual page - man7.org"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.linux.org/docs/man1/trap.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("trap(1) manual - linux.org"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"http://man.linuxde.net/trap",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux命令大全.trap命令"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/holandstone/article/details/6738769",target:"_blank",rel:"noopener noreferrer"}},[t._v("linux中的trap命令"),a("OutboundLink")],1)]),t._v(" "),a("Vssue",{attrs:{title:"trap-builtin"}})],1)}),[],!1,null,null,null);a.default=_.exports}}]);